(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[487],{9870:function(e,t,o){Promise.resolve().then(o.bind(o,5936))},5936:function(e,t,o){"use strict";o.r(t);var a=o(7437),n=o(6463),r=o(2265),s=o(9450),l=o(9842),i=o(5344),c=o(4769),u=o.n(c),d=o(8370),m=o(3299);t.default=(0,d.Z)(()=>{let e=(0,n.useRouter)(),[t,o]=(0,r.useState)(s.ou.now().setZone("America/Edmonton").toLocaleString(s.ou.DATETIME_FULL_WITH_SECONDS)),[c,d]=(0,r.useState)(""),[p,h]=(0,r.useState)(""),[_,k]=(0,r.useState)("15"),[y,w]=(0,r.useState)(""),[f,g]=(0,r.useState)("select"),[b,x]=(0,r.useState)([]),[S,j]=(0,r.useState)(null),[I,v]=(0,r.useState)(!1),[B,E]=(0,r.useState)(!1),[C,N]=(0,r.useState)(null),[T,O]=(0,r.useState)(0),[D,L]=(0,r.useState)(""),[M,A]=(0,r.useState)(600),[Z,P]=(0,r.useState)(!1),[G,U]=(0,r.useState)(""),[J,F]=(0,r.useState)(""),[H,z]=(0,r.useState)(""),[q,R]=(0,r.useState)(0),W=(0,r.useCallback)(e=>{x(o=>[...o,{time:t,message:e}])},[t]),K=(0,r.useCallback)(()=>(e.push("/"),600),[e]);(0,r.useEffect)(()=>{let e=localStorage.getItem("userName"),t=localStorage.getItem("userId");e&&d(e),t&&h(t),(async()=>{if(t){let e=(0,l.IO)((0,l.hJ)(i.Z,"employee"),(0,l.ar)("id","==",t)),o=await (0,l.PL)(e);o.empty||("online"===o.docs[0].data().status?(v(!0),(0,m.x$)(t,R)):v(!1))}})();let a=setInterval(()=>{let e=s.ou.now().setZone("America/Edmonton");o(e.toLocaleString(s.ou.DATETIME_FULL_WITH_SECONDS)),A(e=>e<=1?K():e-1),(0,m.x$)(p,R);let t=e.hour;t<12?L("Good morning"):t<18?L("Good afternoon"):L("Good evening")},1e3);return()=>clearInterval(a)},[K,p]);let X=e=>{g(e.target.value),"select"===e.target.value?w(""):k("")},$=async e=>{if(e.preventDefault(),J!==H){alert("New password and confirm new password do not match.");return}try{let e=(0,l.IO)((0,l.hJ)(i.Z,"employee"),(0,l.ar)("id","==",p)),t=await (0,l.PL)(e);if(t.empty){alert("Employee ID does not exist");return}let o=t.docs[0];if(o.data().password!==G){alert("Current password is incorrect.");return}let a=(0,l.JU)(i.Z,"employee",o.id);await (0,l.r7)(a,{password:J}),alert("Password changed successfully!"),P(!1)}catch(e){console.error("Error updating password: ",e),alert("Error updating password.")}};return(0,a.jsxs)("div",{className:u().container,children:[(0,a.jsx)("title",{children:"MTG - Employee"}),(0,a.jsxs)("div",{className:u().formContainer,children:[(0,a.jsxs)("h1",{children:[D,", ",c,"!"]}),(0,a.jsxs)("div",{className:u().currentTime,children:["Current Time: ",t]}),(0,a.jsxs)("div",{className:u().currentTime,children:["Auto Logout In: ",Math.floor(M/60),":",String(M%60).padStart(2,"0")]}),(0,a.jsxs)("div",{className:u().currentTime,children:["Today's Work Duration: ",0===q?"0 h 0 m":"".concat(Math.floor(q/60)," h ").concat(q%60," m")]})," ",(0,a.jsxs)("div",{className:u().buttonAndBreakGroup,children:[(0,a.jsxs)("div",{className:u().buttonGroup,children:[(0,a.jsx)("button",{className:"".concat(u().clockInButton," ").concat(I?u().disabledButton:""),onClick:()=>(0,m.el)(p,N,v,W,R),disabled:I,children:"Clock In"}),(0,a.jsx)("button",{className:"".concat(u().clockOutButton," ").concat(I?"":u().disabledButton),onClick:()=>(0,m.hq)(p,v,W,R,E),disabled:!I,children:"Clock Out"}),(0,a.jsx)("button",{className:u().changePasswordButton,onClick:()=>P(!0),children:"Change Password"})]}),(0,a.jsxs)("div",{className:u().breakGroup,children:[(0,a.jsxs)("div",{className:u().breakOption,children:[(0,a.jsx)("input",{type:"radio",name:"breakOption",value:"select",checked:"select"===f,onChange:X,disabled:!I}),(0,a.jsxs)("select",{className:u().breakSelect,value:_,onChange:e=>{k(e.target.value),g("select")},disabled:"select"!==f||!I,children:[(0,a.jsx)("option",{value:"15",children:"15 min"}),(0,a.jsx)("option",{value:"30",children:"30 min"}),(0,a.jsx)("option",{value:"45",children:"45 min"}),(0,a.jsx)("option",{value:"60",children:"60 min"})]})]}),(0,a.jsxs)("div",{className:u().breakOption,children:[(0,a.jsx)("input",{type:"radio",name:"breakOption",value:"custom",checked:"custom"===f,onChange:X,disabled:!I}),(0,a.jsx)("input",{type:"number",className:u().breakInput,placeholder:"Custom",value:y,onChange:e=>{w(e.target.value),g("custom")},disabled:"custom"!==f||!I,min:"1"})]}),(0,a.jsx)("button",{className:"".concat(u().startBreakButton," ").concat(!I||B?u().disabledButton:""),onClick:()=>{let e="select"===f?_:y;if(""===e||0===parseInt(e)){alert("Break duration must be greater than 0 and not empty.");return}(0,m.pM)(p,E,j,e,W)},disabled:!I||B,children:"Start Break"})]})]}),(0,a.jsx)("div",{className:u().log,children:(0,a.jsxs)("table",{className:u().logTable,children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{children:"Time"}),(0,a.jsx)("th",{children:"Message"})]})}),(0,a.jsx)("tbody",{children:b.map((e,t)=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{children:e.time}),(0,a.jsx)("td",{children:e.message})]},t))})]})}),(0,a.jsx)("button",{className:u().logoutButton,onClick:()=>{e.push("/")},children:"Log Out"})]}),Z&&(0,a.jsx)("div",{className:u().passwordModal,children:(0,a.jsx)("div",{className:u().passwordModalContent,children:(0,a.jsxs)("form",{onSubmit:$,children:[(0,a.jsxs)("div",{className:u().formGroup,children:[(0,a.jsx)("label",{children:"Current Password:"}),(0,a.jsx)("input",{type:"password",value:G,onChange:e=>U(e.target.value)})]}),(0,a.jsxs)("div",{className:u().formGroup,children:[(0,a.jsx)("label",{children:"New Password:"}),(0,a.jsx)("input",{type:"password",value:J,onChange:e=>F(e.target.value)})]}),(0,a.jsxs)("div",{className:u().formGroup,children:[(0,a.jsx)("label",{children:"Confirm New Password:"}),(0,a.jsx)("input",{type:"password",value:H,onChange:e=>z(e.target.value)})]}),(0,a.jsxs)("div",{className:u().passwordModalButtons,children:[(0,a.jsx)("button",{type:"submit",children:"Confirm"}),(0,a.jsx)("button",{type:"button",onClick:()=>P(!1),children:"Cancel"})]})]})})})]})})},3299:function(e,t,o){"use strict";o.d(t,{el:function(){return c},hq:function(){return u},pM:function(){return d},x$:function(){return i}});var a=o(9842),n=o(9450),r=o(5344);let s=null,l=(e,t)=>{s&&clearInterval(s),s=setInterval(async()=>{await i(e,t)},6e4)},i=async(e,t)=>{let o=(0,a.IO)((0,a.hJ)(r.Z,"employee"),(0,a.ar)("id","==",e)),l=await (0,a.PL)(o);if(!l.empty){let e=l.docs[0],o=(0,a.JU)(r.Z,"employee",e.id),i=e.data();if("online"===i.status){let e=n.ou.now().setZone("America/Edmonton"),r=e.toISODate(),s=i.workTime[r],l=n.ou.fromISO(s.split(" - ")[0],{zone:"America/Edmonton"}),c=i.totalBreakDuration||0,u=Math.round(e.diff(l,"minutes").minutes-c);u<0&&(u=0),t(u);let d={...i.workPeriod,[r]:u};await (0,a.r7)(o,{workDurationToday:u,workPeriod:d}),console.log("Work duration updated successfully.")}else clearInterval(s)}},c=async(e,t,o,s,i)=>{let c=(0,a.IO)((0,a.hJ)(r.Z,"employee"),(0,a.ar)("id","==",e));try{let u=await (0,a.PL)(c);if(u.empty)console.log("User document does not exist for ID: ".concat(e));else{let c=u.docs[0],d=(0,a.JU)(r.Z,"employee",c.id),m=c.data(),p=n.ou.now().setZone("America/Edmonton"),h=p.weekdayLong,_=m.workHours[h];if(" - "===_){alert("Today is a day off, you cannot clock in.");return}let[k,y]=_.split(" - "),w=n.ou.fromISO(k,{zone:"America/Edmonton"}).minus({minutes:30}),f=n.ou.fromISO(y,{zone:"America/Edmonton"}).plus({minutes:30});if(p<w||p>f){alert("It is not within the allowed clock-in time range.");return}o(!0),t(p),s("Clocked In at ".concat(p.toLocaleString(n.ou.DATETIME_FULL_WITH_SECONDS)));let g=p.toISODate(),b={...m.workTime,[g]:p.toFormat("HH:mm")};await (0,a.r7)(d,{status:"online",workDurationToday:0,workTime:b,totalBreakDuration:0,isOnBreak:!1}),console.log("User status set to online and workDurationToday initialized."),l(e,i)}}catch(e){console.error("Error clocking in:",e)}},u=async(e,t,o,s,l)=>{t(!1);let i=n.ou.now().setZone("America/Edmonton");o("Clocked Out at ".concat(i.toLocaleString(n.ou.DATETIME_FULL_WITH_SECONDS)));let c=(0,a.IO)((0,a.hJ)(r.Z,"employee"),(0,a.ar)("id","==",e));try{let t=await (0,a.PL)(c);if(t.empty)console.log("User document does not exist for ID: ".concat(e));else{let e=t.docs[0],o=(0,a.JU)(r.Z,"employee",e.id),c=e.data(),u=i.toISODate(),d=c.workTime[u],m=n.ou.fromISO(d,{zone:"America/Edmonton"}),p=Math.round(i.diff(m,"minutes").minutes-(c.totalBreakDuration||0));p<0&&(p=0);let h={...c.workPeriod,[u]:p},_={...c.workTime,[u]:"".concat(d," - ").concat(i.toFormat("HH:mm"))};await (0,a.r7)(o,{status:"offline",lastOnlineDate:u,isOnBreak:!1,workDurationToday:p,workPeriod:h,workTime:_}),console.log("User status set to offline and work duration updated."),s(p),l(!1)}}catch(e){console.error("Error clocking out:",e)}},d=async(e,t,o,s,l)=>{t(!0),l("Break started at ".concat(n.ou.now().setZone("America/Edmonton").toLocaleString(n.ou.DATETIME_FULL_WITH_SECONDS)));let i=(0,a.IO)((0,a.hJ)(r.Z,"employee"),(0,a.ar)("id","==",e)),c=await (0,a.PL)(i);if(!c.empty){let e=c.docs[0],i=(0,a.JU)(r.Z,"employee",e.id),u=(e.data().totalBreakDuration||0)+parseInt(s);await (0,a.r7)(i,{isOnBreak:!0,totalBreakDuration:u}),o(setTimeout(async()=>{t(!1),l("Break ended at ".concat(n.ou.now().setZone("America/Edmonton").toLocaleString(n.ou.DATETIME_FULL_WITH_SECONDS))),await (0,a.r7)(i,{isOnBreak:!1}),o(null)},6e4*s))}}},5344:function(e,t,o){"use strict";var a=o(5236),n=o(9842),r=o(9854);let s=(0,a.ZF)({apiKey:"AIzaSyB5__zMeXEsk4RxME0Fg46Sz7AhqZzA9qE",authDomain:"mtg-quickyclock.firebaseapp.com",projectId:"mtg-quickyclock",storageBucket:"mtg-quickyclock.appspot.com",messagingSenderId:"865821745601",appId:"1:865821745601:web:b01221defd23ac3d338f40"}),l=(0,n.ad)(s);(0,r.cF)(s),t.Z=l},8370:function(e,t,o){"use strict";var a=o(7437),n=o(6463),r=o(2265);t.Z=e=>{let t=t=>{let o=(0,n.useRouter)();return(0,r.useEffect)(()=>{{let e=localStorage.getItem("userName"),t=localStorage.getItem("adminName");e||t||o.push("/")}},[o]),(0,a.jsx)(e,{...t})};return t.displayName="withAuth(".concat(e.displayName||e.name||"Component",")"),t}},4769:function(e){e.exports={container:"employee_container__38_MF",formContainer:"employee_formContainer__b8qtM",currentTime:"employee_currentTime__fa65a",buttonAndBreakGroup:"employee_buttonAndBreakGroup__nsAjr",buttonGroup:"employee_buttonGroup__hBnnY",clockInButton:"employee_clockInButton__zL5RK",clockOutButton:"employee_clockOutButton___OENO",changePasswordButton:"employee_changePasswordButton__2ykY_",startBreakButton:"employee_startBreakButton__KRkim",button:"employee_button__RdhaT",disabledButton:"employee_disabledButton__h46X_",breakGroup:"employee_breakGroup__6AevP",breakOption:"employee_breakOption__f249u",breakSelect:"employee_breakSelect__yDLJJ",breakInput:"employee_breakInput__uUJRy",log:"employee_log__9iUMH",logTable:"employee_logTable__oFT7h",logoutButton:"employee_logoutButton__CdvJg",passwordModal:"employee_passwordModal__8ubjX",passwordModalContent:"employee_passwordModalContent__oqHd5",formGroup:"employee_formGroup__Rojk9",passwordModalButtons:"employee_passwordModalButtons__S2Ob5"}}},function(e){e.O(0,[432,358,900,971,23,744],function(){return e(e.s=9870)}),_N_E=e.O()}]);