(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{4654:function(){},5897:function(e,o,t){Promise.resolve().then(t.bind(t,200))},3458:function(e,o,t){"use strict";t.d(o,{el:function(){return d},hq:function(){return u},pM:function(){return m},x$:function(){return c}});var a=t(9842),r=t(9450),A=t(5344),n=t(5871),i=t(5494);let l=()=>new Promise((e,o)=>{navigator.geolocation.getCurrentPosition(e,o,{enableHighAccuracy:!0,timeout:5e3,maximumAge:6e4})}),s=async e=>{try{let o=(0,a.IO)((0,a.hJ)(A.ZP,"employee"),(0,a.ar)("id","==",e)),t=await (0,a.PL)(o);if(t.empty)return console.error("No user found with the given ID"),!1;let r=t.docs[0].data().geofence;if("None"==r)return!0;if(!r)return console.error("No geofence location ID found for the user"),!1;let s=(0,a.JU)(A.ZP,"geofence",r),c=await (0,a.QT)(s);if(!c.exists())return console.error("No geofence document found"),!1;let d=c.data().geopoint;if(!d||!d.latitude||!d.longitude)return console.error("Invalid geofence location data"),!1;let u=await l(),m=[u.coords.longitude,u.coords.latitude],g=(0,n.xm)(m),f=(0,n.xm)([d.longitude,d.latitude]);return 5>=(0,i.T)(f,g,{units:"kilometers"})}catch(e){return console.error("Error validating location:",e),!1}},c=async(e,o)=>{let t=(0,a.IO)((0,a.hJ)(A.ZP,"employee"),(0,a.ar)("id","==",e)),n=await (0,a.PL)(t);if(!n.empty){let e=n.docs[0],t=(0,a.JU)(A.ZP,"employee",e.id),i=e.data();if("online"===i.status){let e=r.ou.now().setZone("America/Edmonton"),A=e.toISODate(),n=i.workTime[A];if(!n){console.log("No clock-in entry found for today.");return}let l=r.ou.fromISO(n.split(" - ")[0],{zone:"America/Edmonton"}),s=i.totalBreakDuration||0,c=Math.round(e.diff(l,"minutes").minutes-s);c<0&&(c=0),o(c);let d=i.workPeriod[A]||0,u={...i.workPeriod,[A]:d+c};await (0,a.r7)(t,{workDurationToday:c,workPeriod:u}),console.log("Work duration updated successfully.")}}},d=async(e,o,t,n,i)=>{if(i(!0),!await s(e)){i(!1),alert("You are not within the allowed location to clock in.");return}i(!1);let l=(0,a.IO)((0,a.hJ)(A.ZP,"employee"),(0,a.ar)("id","==",e));try{let i=await (0,a.PL)(l);if(i.empty)console.log("User document does not exist for ID: ".concat(e));else{let e=i.docs[0],l=(0,a.JU)(A.ZP,"employee",e.id),s=e.data(),c=r.ou.now().setZone("America/Edmonton"),d=c.weekdayLong,u=s.workHours[d];if(" - "===u){alert("Today is a day off, you cannot clock in.");return}let[m,g]=u.split(" - "),f=r.ou.fromISO(m,{zone:"America/Edmonton"}).minus({minutes:30}),w=r.ou.fromISO(g,{zone:"America/Edmonton"}).plus({minutes:30});if(c<f||c>w){alert("It is not within the allowed clock-in time range.");return}t(!0),o(c),n("Clocked In at ".concat(c.toLocaleString(r.ou.DATETIME_FULL_WITH_SECONDS)));let E=c.toISODate(),y={...s.workTime,[E]:c.toFormat("HH:mm")};await (0,a.r7)(l,{status:"online",workTime:y,totalBreakDuration:0,isOnBreak:!1})}}catch(e){console.error("Error clocking in:",e)}},u=async(e,o,t,n,i)=>{o(!1);let l=r.ou.now().setZone("America/Edmonton");t("Clocked Out at ".concat(l.toLocaleString(r.ou.DATETIME_FULL_WITH_SECONDS)));let s=(0,a.IO)((0,a.hJ)(A.ZP,"employee"),(0,a.ar)("id","==",e));try{let o=await (0,a.PL)(s);if(o.empty)console.log("User document does not exist for ID: ".concat(e));else{let e=o.docs[0],t=(0,a.JU)(A.ZP,"employee",e.id),s=e.data(),c=l.toISODate(),d=s.workTime[c];if(!d){console.log("No clock-in entry found for today.");return}let u=r.ou.fromISO(d,{zone:"America/Edmonton"}),m=Math.round(l.diff(u,"minutes").minutes-(s.totalBreakDuration||0));m<0&&(m=0);let g=s.workPeriod[c]||0;m+=g;let f={...s.workPeriod,[c]:m},w={...s.workTime,[c]:"".concat(d," - ").concat(l.toFormat("HH:mm"))};if(await (0,a.r7)(t,{status:"offline",lastOnlineDate:c,isOnBreak:!1,workDurationToday:m,workPeriod:f,workTime:w}),l.startOf("day")>u.startOf("day")){let e=l.plus({days:1}).toISODate(),o=s.workPeriod[e]||0;await (0,a.r7)(t,{workPeriod:{...s.workPeriod,[e]:o+m}})}console.log("User status set to offline and work duration updated."),n(m),i(!1)}}catch(e){console.error("Error clocking out:",e)}},m=async(e,o,t,n,i)=>{o(!0),i("Break started at ".concat(r.ou.now().setZone("America/Edmonton").toLocaleString(r.ou.DATETIME_FULL_WITH_SECONDS)));let l=(0,a.IO)((0,a.hJ)(A.ZP,"employee"),(0,a.ar)("id","==",e)),s=await (0,a.PL)(l);if(!s.empty){let e=s.docs[0],l=(0,a.JU)(A.ZP,"employee",e.id),c=(e.data().totalBreakDuration||0)+parseInt(n);await (0,a.r7)(l,{isOnBreak:!0,totalBreakDuration:c}),t(setTimeout(async()=>{o(!1),i("Break ended at ".concat(r.ou.now().setZone("America/Edmonton").toLocaleString(r.ou.DATETIME_FULL_WITH_SECONDS))),await (0,a.r7)(l,{isOnBreak:!1}),t(null)},6e4*n))}}},5344:function(e,o,t){"use strict";var a=t(5236),r=t(9842),A=t(9854),n=t(5735);let i=(0,a.ZF)({apiKey:"AIzaSyB5__zMeXEsk4RxME0Fg46Sz7AhqZzA9qE",authDomain:"mtg-quickyclock.firebaseapp.com",projectId:"mtg-quickyclock",storageBucket:"mtg-quickyclock.appspot.com",messagingSenderId:"865821745601",appId:"1:865821745601:web:b01221defd23ac3d338f40"}),l=(0,r.ad)(i);(0,A.cF)(i),(0,n.v0)(i),o.ZP=l},200:function(e,o,t){"use strict";t.r(o),t.d(o,{default:function(){return f}});var a=t(7437),r=t(6463),A=t(2265),n=t(6648),i=t(9842),l=t(5344),s=t(9450),c={src:"/_next/static/media/MTGBCSLogo.3420c02d.jpg",height:960,width:2304,blurDataURL:"data:image/jpeg;base64,/9j/2wBDAAoHBwgHBgoICAgLCgoLDhgQDg0NDh0VFhEYIx8lJCIfIiEmKzcvJik0KSEiMEExNDk7Pj4+JS5ESUM8SDc9Pjv/2wBDAQoLCw4NDhwQEBw7KCIoOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozv/wgARCAADAAgDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAb/xAAUAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAGrAf/EABUQAQEAAAAAAAAAAAAAAAAAAAEC/9oACAEBAAEFAiQr/8QAFBEBAAAAAAAAAAAAAAAAAAAAAP/aAAgBAwEBPwF//8QAFBEBAAAAAAAAAAAAAAAAAAAAAP/aAAgBAgEBPwF//8QAFRABAQAAAAAAAAAAAAAAAAAAACH/2gAIAQEABj8Cj//EABgQAQADAQAAAAAAAAAAAAAAAAEAESEx/9oACAEBAAE/Ic4S1ez/2gAMAwEAAgADAAAAEP8A/8QAFxEBAAMAAAAAAAAAAAAAAAAAAQARMf/aAAgBAwEBPxCgyf/EABYRAQEBAAAAAAAAAAAAAAAAAAEAIf/aAAgBAgEBPxAVNv/EABgQAQADAQAAAAAAAAAAAAAAAAEAESFh/9oACAEBAAE/EMGCBfW3s//Z",blurWidth:8,blurHeight:3},d=t(3458),u=t(7513),m=t.n(u);let g=async(e,o)=>{try{let t=(0,i.IO)((0,i.hJ)(l.ZP,"employee"),(0,i.ar)("id","==",e)),a=await (0,i.PL)(t);if(a.empty)return!1;let r=a.docs[0].data(),A=r.password;if(m().compareSync(o,A)||o==r.password)return a.docs[0].data();return!1}catch(e){console.error("Error during login:",e)}};function f(){let e=(0,r.useRouter)(),o=async()=>{let e=s.ou.now().setZone("America/Edmonton").toISODate();(await (0,i.PL)((0,i.hJ)(l.ZP,"employee"))).forEach(async o=>{let t=o.data().lastOnlineDate||e;if(e!==t){let e=(0,i.JU)(l.ZP,"employee",o.id);await (0,i.r7)(e,{workDurationToday:0})}})};(0,A.useEffect)(()=>{o()},[]);let t=async()=>{try{let o=document.getElementById("mtgId").value,t=document.getElementById("password").value,a=await g(o,t);a?(localStorage.setItem("userName",a.name),localStorage.setItem("userId",o),e.push("/employee")):(console.error("Invalid credentials"),alert("Invalid credentials"))}catch(e){console.error("Error during login:",e)}},u=async()=>{let o=document.getElementById("mtgId").value,t=document.getElementById("password").value,a=await g(o,t);a?"admin"===a.class?(localStorage.setItem("adminName",a.name),localStorage.setItem("userId",o),(0,d.x$)(o),e.push("/admin")):(console.error("You are not authorized to access admin page"),alert("You are not authorized to access admin page")):(console.error("Invalid credentials"),alert("Invalid credentials"))};return(0,a.jsxs)("div",{className:"relative w-full h-screen bg-cover bg-center bg-no-repeat",style:{backgroundImage:"url('/images/eebg.jpg')"},children:[(0,a.jsx)("div",{className:"flex items-center justify-center lg:justify-end h-full px-4 lg:px-32",children:(0,a.jsxs)("div",{className:"flex flex-col items-center w-full max-w-sm space-y-4 bg-white bg-opacity-80 p-6 rounded-lg shadow-lg",children:[(0,a.jsx)(n.default,{src:c,alt:"MTG Logo",className:"w-64 h-auto"}),(0,a.jsx)("input",{type:"text",placeholder:"Enter Your MTG ID",className:"p-4 block w-full bg-gray-200 border border-gray-300 rounded-lg text-sm placeholder-gray-400",id:"mtgId"}),(0,a.jsx)("input",{type:"password",placeholder:"Password",className:"p-4 block w-full bg-gray-200 border border-gray-300 rounded-lg text-sm placeholder-gray-400",id:"password"}),(0,a.jsx)("button",{className:"bg-blue-500 text-white p-2 rounded-lg w-full hover:bg-blue-600 transition-colors",onClick:t,children:"Login"}),(0,a.jsx)("a",{onClick:u,className:"text-blue-500 cursor-pointer hover:underline",children:"Login as Admin"})]})}),(0,a.jsx)("div",{className:"absolute bottom-4 w-full text-center text-gray-600",children:"\xa9 2024 MTG Healthcare Academy"})]})}}},function(e){e.O(0,[358,208,218,379,813,648,971,23,744],function(){return e(e.s=5897)}),_N_E=e.O()}]);