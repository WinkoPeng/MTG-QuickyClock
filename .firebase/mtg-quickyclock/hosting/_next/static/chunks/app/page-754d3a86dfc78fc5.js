(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{4654:function(){},5897:function(e,t,o){Promise.resolve().then(o.bind(o,9320))},3458:function(e,t,o){"use strict";o.d(t,{el:function(){return m},hq:function(){return g},pM:function(){return f},x$:function(){return u}});var a=o(9842),A=o(9450),r=o(5344),n=o(5871),l=o(5494);let i=()=>new Promise((e,t)=>{navigator.geolocation.getCurrentPosition(e,t,{enableHighAccuracy:!0,timeout:5e3,maximumAge:6e4})}),s=async e=>{try{let t=(0,a.IO)((0,a.hJ)(r.Z,"employee"),(0,a.ar)("id","==",e)),o=await (0,a.PL)(t);if(o.empty)return console.error("No user found with the given ID"),!1;let A=o.docs[0].data().geofence;if("None"==A)return!0;if(!A)return console.error("No geofence location ID found for the user"),!1;let s=(0,a.JU)(r.Z,"geofence",A),c=await (0,a.QT)(s);if(!c.exists())return console.error("No geofence document found"),!1;let d=c.data().geopoint;if(!d||!d.latitude||!d.longitude)return console.error("Invalid geofence location data"),!1;let u=await i(),m=[u.coords.longitude,u.coords.latitude],g=(0,n.xm)(m),f=(0,n.xm)([d.longitude,d.latitude]);return 5>=(0,l.T)(f,g,{units:"kilometers"})}catch(e){return console.error("Error validating location:",e),!1}},c=null,d=(e,t)=>{c&&clearInterval(c),c=setInterval(async()=>{await u(e,t)},6e4)},u=async(e,t)=>{let o=(0,a.IO)((0,a.hJ)(r.Z,"employee"),(0,a.ar)("id","==",e)),n=await (0,a.PL)(o);if(!n.empty){let e=n.docs[0],o=(0,a.JU)(r.Z,"employee",e.id),l=e.data();if("online"===l.status){let e=A.ou.now().setZone("America/Edmonton"),r=e.toISODate(),n=l.workTime[r],i=A.ou.fromISO(n.split(" - ")[0],{zone:"America/Edmonton"}),s=l.totalBreakDuration||0,c=Math.round(e.diff(i,"minutes").minutes-s);c<0&&(c=0),t(c);let d={...l.workPeriod,[r]:c};await (0,a.r7)(o,{workDurationToday:c,workPeriod:d}),console.log("Work duration updated successfully.")}else clearInterval(c)}},m=async(e,t,o,n,l)=>{if(!await s(e)){alert("You are not within the allowed location to clock in.");return}let i=(0,a.IO)((0,a.hJ)(r.Z,"employee"),(0,a.ar)("id","==",e));try{let s=await (0,a.PL)(i);if(s.empty)console.log("User document does not exist for ID: ".concat(e));else{let i=s.docs[0],c=(0,a.JU)(r.Z,"employee",i.id),u=i.data(),m=A.ou.now().setZone("America/Edmonton"),g=m.weekdayLong,f=u.workHours[g];if(" - "===f){alert("Today is a day off, you cannot clock in.");return}let[w,E]=f.split(" - "),p=A.ou.fromISO(w,{zone:"America/Edmonton"}).minus({minutes:30}),y=A.ou.fromISO(E,{zone:"America/Edmonton"}).plus({minutes:30});if(m<p||m>y){alert("It is not within the allowed clock-in time range.");return}o(!0),t(m),n("Clocked In at ".concat(m.toLocaleString(A.ou.DATETIME_FULL_WITH_SECONDS)));let I=m.toISODate(),h={...u.workTime,[I]:m.toFormat("HH:mm")};await (0,a.r7)(c,{status:"online",workDurationToday:0,workTime:h,totalBreakDuration:0,isOnBreak:!1}),console.log("User status set to online and workDurationToday initialized."),d(e,l)}}catch(e){console.error("Error clocking in:",e)}},g=async(e,t,o,n,l)=>{t(!1);let i=A.ou.now().setZone("America/Edmonton");o("Clocked Out at ".concat(i.toLocaleString(A.ou.DATETIME_FULL_WITH_SECONDS)));let s=(0,a.IO)((0,a.hJ)(r.Z,"employee"),(0,a.ar)("id","==",e));try{let t=await (0,a.PL)(s);if(t.empty)console.log("User document does not exist for ID: ".concat(e));else{let e=t.docs[0],o=(0,a.JU)(r.Z,"employee",e.id),s=e.data(),c=i.toISODate(),d=s.workTime[c],u=A.ou.fromISO(d,{zone:"America/Edmonton"}),m=Math.round(i.diff(u,"minutes").minutes-(s.totalBreakDuration||0));m<0&&(m=0);let g={...s.workPeriod,[c]:m},f={...s.workTime,[c]:"".concat(d," - ").concat(i.toFormat("HH:mm"))};await (0,a.r7)(o,{status:"offline",lastOnlineDate:c,isOnBreak:!1,workDurationToday:m,workPeriod:g,workTime:f}),console.log("User status set to offline and work duration updated."),n(m),l(!1)}}catch(e){console.error("Error clocking out:",e)}},f=async(e,t,o,n,l)=>{t(!0),l("Break started at ".concat(A.ou.now().setZone("America/Edmonton").toLocaleString(A.ou.DATETIME_FULL_WITH_SECONDS)));let i=(0,a.IO)((0,a.hJ)(r.Z,"employee"),(0,a.ar)("id","==",e)),s=await (0,a.PL)(i);if(!s.empty){let e=s.docs[0],i=(0,a.JU)(r.Z,"employee",e.id),c=(e.data().totalBreakDuration||0)+parseInt(n);await (0,a.r7)(i,{isOnBreak:!0,totalBreakDuration:c}),o(setTimeout(async()=>{t(!1),l("Break ended at ".concat(A.ou.now().setZone("America/Edmonton").toLocaleString(A.ou.DATETIME_FULL_WITH_SECONDS))),await (0,a.r7)(i,{isOnBreak:!1}),o(null)},6e4*n))}}},5344:function(e,t,o){"use strict";var a=o(5236),A=o(9842),r=o(9854);let n=(0,a.ZF)({apiKey:"AIzaSyB5__zMeXEsk4RxME0Fg46Sz7AhqZzA9qE",authDomain:"mtg-quickyclock.firebaseapp.com",projectId:"mtg-quickyclock",storageBucket:"mtg-quickyclock.appspot.com",messagingSenderId:"865821745601",appId:"1:865821745601:web:b01221defd23ac3d338f40"}),l=(0,A.ad)(n);(0,r.cF)(n),t.Z=l},9320:function(e,t,o){"use strict";o.r(t),o.d(t,{default:function(){return u}});var a=o(7437),A=o(6463),r=o(2265),n=o(6648),l=o(9842),i=o(5344),s=o(9450),c={src:"/_next/static/media/MTGBCSLogo.3420c02d.jpg",height:960,width:2304,blurDataURL:"data:image/jpeg;base64,/9j/2wBDAAoHBwgHBgoICAgLCgoLDhgQDg0NDh0VFhEYIx8lJCIfIiEmKzcvJik0KSEiMEExNDk7Pj4+JS5ESUM8SDc9Pjv/2wBDAQoLCw4NDhwQEBw7KCIoOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozv/wgARCAADAAgDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAb/xAAUAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAGrAf/EABUQAQEAAAAAAAAAAAAAAAAAAAEC/9oACAEBAAEFAiQr/8QAFBEBAAAAAAAAAAAAAAAAAAAAAP/aAAgBAwEBPwF//8QAFBEBAAAAAAAAAAAAAAAAAAAAAP/aAAgBAgEBPwF//8QAFRABAQAAAAAAAAAAAAAAAAAAACH/2gAIAQEABj8Cj//EABgQAQADAQAAAAAAAAAAAAAAAAEAESEx/9oACAEBAAE/Ic4S1ez/2gAMAwEAAgADAAAAEP8A/8QAFxEBAAMAAAAAAAAAAAAAAAAAAQARMf/aAAgBAwEBPxCgyf/EABYRAQEBAAAAAAAAAAAAAAAAAAEAIf/aAAgBAgEBPxAVNv/EABgQAQADAQAAAAAAAAAAAAAAAAEAESFh/9oACAEBAAE/EMGCBfW3s//Z",blurWidth:8,blurHeight:3},d=o(3458);function u(){let e=(0,A.useRouter)(),t=async()=>{let e=s.ou.now().setZone("America/Edmonton").toISODate();(await (0,l.PL)((0,l.hJ)(i.Z,"employee"))).forEach(async t=>{let o=t.data().lastOnlineDate||e;if(e!==o){let e=(0,l.JU)(i.Z,"employee",t.id);await (0,l.r7)(e,{workDurationToday:0})}})};(0,r.useEffect)(()=>{t()},[]);let o=async()=>{let t=document.getElementById("mtgId").value,o=document.getElementById("password").value,a=(0,l.IO)((0,l.hJ)(i.Z,"employee"),(0,l.ar)("id","==",t),(0,l.ar)("password","==",o)),A=await (0,l.PL)(a);if(A.empty)console.error("Invalid credentials"),alert("Invalid credentials");else{let o=A.docs[0].data();localStorage.setItem("userName",o.name),localStorage.setItem("userId",t),(0,d.x$)(t),e.push("/employee")}},u=async()=>{let t=document.getElementById("mtgId").value,o=document.getElementById("password").value,a=(0,l.IO)((0,l.hJ)(i.Z,"employee"),(0,l.ar)("id","==",t),(0,l.ar)("password","==",o)),A=await (0,l.PL)(a);if(A.empty)console.error("Invalid credentials"),alert("Invalid credentials");else{let o=A.docs[0].data();"admin"===o.class?(localStorage.setItem("adminName",o.name),localStorage.setItem("userId",t),(0,d.x$)(t),e.push("/admin")):(console.error("You are not authorized to access admin page"),alert("You are not authorized to access admin page"))}};return(0,a.jsxs)("div",{className:"relative w-full h-screen bg-cover bg-center bg-no-repeat",style:{backgroundImage:"url('/images/eebg.jpg')"},children:[(0,a.jsx)("div",{className:"flex items-center justify-center lg:justify-end h-full px-4 lg:px-32",children:(0,a.jsxs)("div",{className:"flex flex-col items-center w-full max-w-sm space-y-4 bg-white bg-opacity-80 p-6 rounded-lg shadow-lg",children:[(0,a.jsx)(n.default,{src:c,alt:"MTG Logo",className:"w-64 h-auto"}),(0,a.jsx)("input",{type:"text",placeholder:"Enter Your MTG ID",className:"p-4 block w-full bg-gray-200 border border-gray-300 rounded-lg text-sm placeholder-gray-400",id:"mtgId"}),(0,a.jsx)("input",{type:"password",placeholder:"Password",className:"p-4 block w-full bg-gray-200 border border-gray-300 rounded-lg text-sm placeholder-gray-400",id:"password"}),(0,a.jsx)("button",{className:"bg-blue-500 text-white p-2 rounded-lg w-full hover:bg-blue-600 transition-colors",onClick:o,children:"Login"}),(0,a.jsx)("a",{onClick:u,className:"text-blue-500 cursor-pointer hover:underline",children:"Login as Admin"})]})}),(0,a.jsx)("div",{className:"absolute bottom-4 w-full text-center text-gray-600",children:"\xa9 2024 MTG Healthcare Academy"})]})}}},function(e){e.O(0,[358,900,494,648,971,23,744],function(){return e(e.s=5897)}),_N_E=e.O()}]);